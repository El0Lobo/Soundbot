<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Soundboard</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://unpkg.com/wavesurfer.js"></script>
</head>

<body>
  <div id="toast" class="toast" aria-live="polite"></div>
  <div id="lockOverlay">
    <div class="lock-card">
      <h2>Log in first</h2>
      <p>This soundboard unlocks after you pair this browser with Discord.</p>
      <div id="overlayLoginMount"></div>
    </div>
  </div>

  <div id="appShell">
    <header class="topbar">
      <div class="brand-row">
        <div class="brand-left">
          <div class="brand-title">
            <img id="guildAvatar" class="avatar guild" alt="Guild icon" />
            <h1><span id="guildNameLabel" class="server-title">Server</span> Soundboard</h1>
            <nav class="nav">
          <button class="modal-open upload-only" data-modal="uploadModal" data-src="/upload">Upload</button>
          <button class="modal-open upload-only" data-modal="importModal" data-src="/import">Import</button>
          <button class="modal-open upload-only" data-modal="introsModal" data-src="/intros">Intro/Outro</button>
          <button class="modal-open upload-only" data-modal="adminModal" data-src="/admin">Edit</button>
          <button id="openYtModal" class="yt-open-btn upload-only">Play YouTube</button>
        </nav>
          </div>
                <div class="toolbar">
        <div class="filters">
          <div class="search-wrap">
            <input id="search" class="compact-input" placeholder="Search…">
            <button id="clearSearch" class="pill ghost-btn" type="button" title="Clear search">✕</button>
          </div>
          <select id="categoryFilter" class="compact-select">
            <option value="all">All</option>
          </select>
          <select id="tagFilter" class="compact-select">
            <option value="all">All tags</option>
          </select>
          <select id="sort" class="compact-select" style="width: fit-content;">
            <option value="title">A–Z</option>
            <option value="category">Category</option>
            <option value="tags">Tags</option>
            <option value="newest">Newest</option>
          </select>
          <button id="favoritesToggle" class="pill favorites-toggle" title="Show only favorites">☆ Favorites</button>
          <button id="editModeBtn" class="pill ghost-btn edit-toggle" style="display:none;">Edit mode</button>
        </div>
      </div>
          <div class="voice-bar hidden" id="voiceBar">
            <select id="guildSelect" class="compact-select" style="display:none;"></select>

            <label class="chip">
              <span>Channel</span>
              <select id="channelSelect" class="compact-select"></select>
            </label>

            <label class="chip">
              <input type="checkbox" id="useMyChannel">
              Use Channel I'm in
            </label>

            <button id="skipBtn" class="pill">Skip</button>
            <button id="stopBtn" class="pill">Stop</button>

            <label class="chip">
              <span>Mode</span>
              <select id="modeSelect" class="compact-select">
                <option value="queue">queue</option>
                <option value="interrupt">interrupt</option>
              </select>
            </label>

            <label class="chip volume-chip">
              <span>Vol</span>
              <input id="volumeRange" type="range" min="0" max="1" step="0.05" value="0.5">
              <span id="volumeLabel">0.5</span>
            </label>

            <button id="refreshGuilds" class="pill">↻</button>
          </div>
        </div>
        <div class="queue-row">
          <button id="toggleVoiceBarBtn" class="pill admin-only" style="display:none;">Voice Controls</button>
                    <button id="moveVoteBtn" class="pill" style="display:none;">Move by vote</button>
          <button id="showQueueBtn" class="pill">Show Queue</button>
          <div id="queueBox" class="queue"></div>
        </div>
        <div id="loginMount" class="login-area">
          <details class="login-box" id="loginBox" open>
            <summary id="loginTitle">Log in</summary>
            <div class="login-muted" id="loginText">
              Pair this browser with Discord.
            </div>
            <div id="loginMeta"></div>
            <div class="login-avatars">
              <img id="userAvatar" class="avatar user" alt="User avatar" />
            </div>

            <div id="pairingControls">
              <div class="login-actions">
                <button id="getCodeBtn" class="compact-select">Get code</button>
                <span id="codeDisplay" class="code-pill" style="display:none;"></span>
              </div>
              <div class="login-actions">
                <input id="codeInput" class="compact-input" placeholder="Enter code…" />
                <button id="startSessionBtn" class="compact-select">Start</button>
              </div>
              <div class="login-muted" id="howToText">
                Run in Discord: <code>/link code:XXXXXX</code>
              </div>
            </div>
          </details>
        </div>
      </div>

    </header>

    <div class="content">
      <div id="voiceBlocker" class="voice-blocker" aria-hidden="true">
        Join a voice channel first to use the soundboard.
      </div>


      <main id="grid"></main>
    </div>

    <!-- MODALS -->
    <div class="modal" id="uploadModal" aria-hidden="true">
      <div class="modal-backdrop" data-close></div>
      <div class="modal-panel wide-modal">
        <div class="modal-header">
          <div class="modal-title">Upload</div>
          <button class="modal-close" data-close>Close</button>
        </div>
        <div class="modal-body">
          <form id="uploadForm" class="upload-form">
            <div class="upload-row">
              <label class="chip grow">
                <span>Title</span>
                <input name="title" id="uploadTitle" required placeholder="Funny sound" />
              </label>
              <label class="chip grow">
                <span>Categories (comma)</span>
                <input name="category" id="uploadCategories" list="upload-category-list" placeholder="memes, sfx" required />
              </label>
              <label class="chip grow">
                <span>Tags (comma)</span>
                <input name="tags" id="uploadTags" list="upload-tag-list" placeholder="loud, bass" />
              </label>
            </div>
            <div class="upload-row">
              <label class="chip grow">
                <span>File</span>
                <input type="file" name="file" id="uploadFile" accept="audio/*" required />
              </label>
              <button id="uploadSubmit" class="pill primary" type="submit">Upload</button>
            </div>
            <audio id="uploadPreview" controls style="display:none;"></audio>
            <div id="uploadStatus" class="muted"></div>
          </form>
        </div>
      </div>
    </div>

    <div class="modal" id="importModal" aria-hidden="true">
      <div class="modal-backdrop" data-close></div>
      <div class="modal-panel medium-modal">
        <div class="modal-header">
          <div class="modal-title">YouTube Import</div>
          <button class="modal-close" data-close>Close</button>
        </div>
        <div class="modal-body">
          <div class="import-form">
            <label class="chip">
              <span>YouTube URL</span>
              <input id="ytUrl" placeholder="https://www.youtube.com/watch?v=..." style="width:100%">
            </label>
            <div class="modal-actions" style="justify-content:flex-start;">
              <button id="loadBtn" class="pill primary">Load</button>
            </div>
            <div id="meta" class="muted"></div>
            <div id="ytEmbed" class="yt-embed"></div>
            <div id="wave" style="margin-top:1rem;"></div>
            <div class="import-range-row">
              <label class="chip">
                <span>Start (s)</span>
                <input id="startSec" type="number" min="0" step="0.1" value="0">
              </label>
              <label class="chip">
                <span>End (s)</span>
                <input id="endSec" type="number" min="0" step="0.1" value="5">
              </label>
              <button id="playSelection" class="pill">Preview selection</button>
            </div>
            <form id="saveForm" class="import-save-form">
              <label class="chip">
                <span>Title</span>
                <input name="title" required>
              </label>
              <label class="chip">
                <span>Categories (comma)</span>
                <input name="category" required>
              </label>
              <label class="chip">
                <span>Tags (comma)</span>
                <input name="tags">
              </label>
              <button type="submit" class="pill primary">Import + Save</button>
            </form>
            <div id="status" class="muted"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="introsModal" aria-hidden="true">
      <div class="modal-backdrop" data-close></div>
      <div class="modal-panel medium-modal">
        <div class="modal-header">
          <div class="modal-title">Intro / Outro</div>
          <button class="modal-close" data-close>Close</button>
        </div>
        <div class="modal-body">
          <div class="panel" style="background:none;border:none;padding:0;">
            <h3>Your intro/outro sounds</h3>
            <div class="intro-row">
              <label class="chip grow">
                <span>Intro</span>
                <select id="introSelect"></select>
              </label>
              <button id="introPreview" class="pill">Preview</button>
            </div>
            <div class="intro-row">
              <label class="chip grow">
                <span>Outro</span>
                <select id="outroSelect"></select>
              </label>
              <button id="outroPreview" class="pill">Preview</button>
            </div>
            <div class="modal-actions" style="margin-top:0.6rem;">
              <button id="saveBtn" class="pill primary">Save</button>
            </div>
            <div id="status" class="status"></div>
            <audio id="preview" controls style="width:100%;margin-top:0.5rem;display:none;"></audio>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="adminModal" aria-hidden="true">
      <div class="modal-backdrop" data-close></div>
      <div class="modal-panel medium-modal">
        <div class="modal-header">
          <div class="modal-title">Admin</div>
          <button class="modal-close" data-close>Close</button>
        </div>
        <div class="modal-body">
          <section class="panel">
            <h2>Manage categories & tags</h2>
            <div class="muted">Rename/Delete require admin access.</div>
            <details class="admin-fold" open>
              <summary>All categories</summary>
              <div id="categoryManager"></div>
            </details>
            <details class="admin-fold">
              <summary>All tags</summary>
              <div id="tagManager"></div>
            </details>
          </section>

          <section class="panel">
            <h2>Edit Sounds</h2>
            <input id="adminSearch" placeholder="Search sounds...">
            <div id="adminList"></div>
          </section>
        </div>
      </div>
    </div>

    <!-- YouTube Play Once Modal -->
    <div class="modal" id="ytModal" aria-hidden="true">
      <div class="modal-backdrop" data-close></div>
      <div class="modal-panel">
        <div class="modal-header">
          <div class="modal-title">Play YouTube once</div>
          <button class="modal-close" data-close>Close</button>
        </div>

        <div class="modal-body">
          <div class="yt-modal-row">
            <input id="ytUrl" class="compact-input" type="text" placeholder="YouTube link…">
            <button id="ytPlayBtn" class="compact-select">Play now</button>
          </div>
          <div id="ytStatus" class="muted" style="margin-top:0.5rem;"></div>
        </div>
      </div>
    </div>

    <!-- Move by vote modal -->
    <div class="modal" id="moveVoteModal" aria-hidden="true">
      <div class="modal-backdrop" data-close></div>
      <div class="modal-panel">
        <div class="modal-header">
          <div class="modal-title">Move by vote</div>
          <button class="modal-close" data-close>Close</button>
        </div>
        <div class="modal-body">
          <div class="form-row">
            <label class="chip" style="width:100%;">
              <span>Target member</span>
              <select id="moveTargetSelect" class="compact-select" style="width:100%;"></select>
            </label>
          </div>
          <div class="modal-actions">
            <button id="startMoveVoteBtn" class="pill primary">Start vote</button>
          </div>
          <div class="muted" style="margin-top:0.5rem;">
            Moves the chosen person to the loop channel after a 60s vote (ties pass).
          </div>
        </div>
      </div>
    </div>

    <!-- Quick edit modal -->
    <div class="modal" id="quickEditModal" aria-hidden="true">
      <div class="modal-backdrop" data-close></div>
      <div class="modal-panel">
        <div class="modal-header">
          <div class="modal-title">Edit sound</div>
          <button class="modal-close" data-close>Close</button>
        </div>
        <div class="modal-body">
          <div class="quick-edit-form">
            <div class="quick-edit-row">
              <label>
                <span>Title</span>
                <input id="editTitle" class="compact-input" type="text" />
              </label>
              <label>
                <span>Categories (comma)</span>
                <input id="editCategories" class="compact-input" list="edit-category-list" placeholder="funny, memes" />
              </label>
            </div>
            <div class="quick-edit-row">
              <label>
                <span>Tags (comma)</span>
                <input id="editTags" class="compact-input" list="edit-tag-list" placeholder="loud, bass" />
              </label>
              <div class="vol-group">
                <span>Volume</span>
                <input id="editVolume" type="range" min="0" max="2" step="0.01" value="1">
                <span id="editVolumeLabel">100%</span>
              </div>
            </div>
          </div>
          <div class="modal-actions">
            <button id="quickEditSave" class="pill primary">Save</button>
          </div>
          <div id="quickEditStatus" class="status-inline"></div>
        </div>
      </div>
    </div>

    <datalist id="edit-category-list"></datalist>
    <datalist id="edit-tag-list"></datalist>
    <datalist id="upload-category-list"></datalist>
    <datalist id="upload-tag-list"></datalist>
    <datalist id="admin-category-list"></datalist>
    <datalist id="admin-tag-list"></datalist>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="lowpoly-bg.js"></script>
    <script src="app.js"></script>
  </div>
</body>

</html>
